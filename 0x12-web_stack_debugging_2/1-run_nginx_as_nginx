#!/bin/bash

# Create the nginx user and group if they don't exist
if ! getent group nginx >/dev/null; then
  groupadd nginx
fi
if ! getent passwd nginx >/dev/null; then
  useradd --system --no-create-home --gid nginx nginx
fi

# Stop the existing Nginx process, if it's running
if [ "$(systemctl is-active nginx)" == "active" ]; then
  systemctl stop nginx
fi

# Configure Nginx to run as the nginx user and listen on all active IPs on port 8080
sed -i 's/user\s\+root;/user nginx;/g' /etc/nginx/nginx.conf
sed -i 's/listen\s\+80;/listen 0.0.0.0:8080;/g' /etc/nginx/conf.d/default.conf

# Start the Nginx process
systemctl start nginx

